# OpenAPI Generated ARA Server

This server folder contains the implementation of a web service server wrapper for the NCATS workflows implementing the 
[NCATS Reasoner Application Programming Interface](https://github.com/NCATS-Tangerine/NCATS-ReasonerStdAPI).

## Overview

This server was generated by the [OpenAPI Generator](https://openapi-generator.tech) project. By using the
[OpenAPI-Spec](https://openapis.org) from a remote server, you can easily generate a server stub.  This
is an example of building a OpenAPI-enabled Flask server.

This example uses the [Connexion](https://github.com/zalando/connexion) library on top of Flask.

## Getting started

### Cloning the Repository

If not already done,  git clone this repository:

```
git clone --recursive https://github.com/ncats/translator-modules.git
```

**Note:** Be sure to use `--recursive` flag to clone the 
[NCATS Reasoner API](https://github.com/NCATS-Tangerine/NCATS-ReasonerStdAPI) dependency.

### Creation of a Python 3.7 Virtual Environment

The code base assumes the use of the Python 3.7 release or better. To ensure this, it is generally advisable to 
build and run the application within a controlled environment (virtual environment or provisioned (i.e. Docker) 
container). 

For direct command line usage, a virtual environment may be used. After cloning the repo, set up a virtual environment 
using Python 3's `venv` module (or your preferred tool, e.g. Conda or local IDE equivalent),

```
python3.7 -m venv venv
```

Here, `python3.7` is assumed to be a Python 3.7 binary. On your systems, you may simply need to type `python3` or even 
`python` (if your default python executable is a release 3.7 or better binary).

The command creates a virtual environment `venv`, which may be activated by typing:

```
source venv/bin/activate
```

To exit the environment, type:

```
deactivate
```

To reenter, source the activate command again.

Alternately, you can also use use `conda` env to manage packages and the development environment:

```
conda create -n translator-modules python=3.7
conda activate translator-modules
```

Some IDE's (e.g. PyCharm) may also have provisions for directly creating such a virtualenv. This should also work fine. 
Simply follow your IDE specific instructions to configure it.

From this point onwards, the `python` executable is assumed to be release 3.7 with a matching `pip` binary.

### Installation of Python Dependencies

Now install required packages,

```
pip install -r requirements.txt --no-cache-dir
```

The `--no-cache-dir` flag ensures that the latest git repositories of special dependency projects are imported each 
time this command is run, given the "research and development" nature of this repository.

Note: double check which version of `pip` you have and its relationship to your Python executable. In some contexts, 
the visible `pip` will not be targeting your python3 binary. A safer way to execute `pip` may therefore be as follows: 

```
python -m pip install -r requirements.txt --no-cache-dir
```

Note that given the rapid cycles of development of the project, it is advisable to periodically rerun the pip module 
installation process to ensure access to the latest synchronized code, especially after a `git pull` operation is done.

## Usage

To run the server, please execute the following from the root directory:

```
python -m reasoner_server
```

and open your browser to here:

```
http://localhost:8080/ui/
```

Your OpenAPI definition lives here:

```
http://localhost:8080/openapi.json
```

To launch the integration tests, use tox:
```
sudo pip install tox
tox
```

## Running with Docker

To run the server on a Docker container, please execute the following from the root directory:

```bash
# building the image
docker build -t reasoner_server .

# starting up a container
docker run -p 8080:8080 reasoner_server
```
